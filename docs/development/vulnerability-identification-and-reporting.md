# How Our Vulnerability System Works

## Overview

This document explains how our vulnerability scanning system identifies CVEs and generates reports, based on the actual implementation. Written in plain English for both technical and non-technical audiences.

## What We Actually Do

### 1. Input: Vuls Scan Results

We start with a JSON file from Vuls that contains all installed packages on a server:

```json
{
  "packages": {
    "curl": {"version": "7.88.1-10+deb12u8"},
    "openssl": {"version": "3.0.13-1~deb12u1"},
    "nginx": {"version": "1.22.1-9"},
    ...hundreds more packages
  }
}
```

### 2. Smart Package Selection

We don't check every package (that would take forever). Instead, we focus on security-critical packages.

**From our test**: Out of 2 packages (curl, openssl), we selected both for scanning because they're both security-critical.

**Critical packages we always check:**
- `openssl`, `openssh-server`, `openssh-client`, `sudo`, `systemd`
- `libc6`, `libc-bin`, `glibc`, `bash`, `curl`, `wget`, `git`
- `perl`, `python3`, `python`, `libxml2`, `expat`, `libexpat1`

**High-risk patterns we look for:**
- Anything with "ssh", "ssl", "tls", "crypto", "crypt" in the name
- Web servers: "nginx", "apache", "http"
- Programming languages: "java", "python", "perl", "php", "ruby", "node"
- Parsers: "xml", "json", "yaml", "parser" (these are often vulnerable)
- Archive tools: "zip", "tar", "gzip", "bzip", "xz"

### 3. Operating System Detection

We figure out what OS you're running by looking at package version patterns:

- **Debian 12**: `7.88.1-10+deb12u8` (has `+deb12`)
- **Ubuntu 22.04**: `1.2.3-4ubuntu5.6` (has `ubuntu` or `~22.04`)
- **Ubuntu 20.04**: `1.2.3-4ubuntu5.6~20.04.1` (has `~20.04`)

**In our test**: We detected Debian from the `+deb12u8` pattern in the curl version.

### 4. Vulnerability Database Lookup

**What actually happens**: We query our PostgreSQL database containing Debian OVAL data.

**From our test results**:
- **Data source used**: Debian OVAL (stored in PostgreSQL)
- **Vulnerabilities found**: 145 CVEs across just 2 packages (curl and openssl)
- **NVD enrichment**: 100% (all 145 CVEs got CVSS scores from our NVD cache)

#### Debian OVAL Data (Our Primary Source)
- **Source**: Official Debian security advisories
- **Storage**: PostgreSQL table `debian_oval_definitions`
- **What we get**: CVE IDs, affected packages, fixed versions
- **Example**: "curl in Debian 12 has CVE-2025-0725, fixed in version 7.88.1-10+deb12u9"

### 5. Version Comparison (The Critical Step)

This is where we determine if you're actually vulnerable:

```
Your curl version: 7.88.1-10+deb12u8
Fixed version:     7.88.1-10+deb12u9
Result: ❌ VULNERABLE (your version is older)
```

**Why this is complex**: Linux package versions have multiple parts:
- `7.88.1` = upstream version (from curl developers)
- `-10` = Debian packaging revision
- `+deb12u8` = Debian 12 security update #8

We have to compare each part correctly to know if you're vulnerable.

### 6. CVE Enrichment with NVD Data

**This is our key innovation** - solving the "missing CVSS scores" problem:

**From our test**:
- **Sample vulnerability**: CVE-2025-0725 in curl
- **Source**: Debian OVAL (tells us it's vulnerable)
- **CVSS Score**: 7.3 (from our NVD cache)
- **Severity**: HIGH (from NVD data)
- **Enhanced by NVD**: True (we added the CVSS data)

**The Process**:
1. Find CVE in Debian OVAL: "CVE-2025-0725 affects curl"
2. Look up CVE in our NVD cache: "CVE-2025-0725 has CVSS score 7.3, HIGH severity"
3. Combine the data: "curl has HIGH severity vulnerability CVE-2025-0725 with CVSS 7.3"

**Success Rate**: 100% enrichment in our test (all 145 CVEs got CVSS scores)

## Data Sources We Use

### Primary Source (Where CVEs Come From)

**Debian OVAL Database** (PostgreSQL table: `debian_oval_definitions`)
- Official Debian security advisories
- Package-specific vulnerability information
- Fix availability and versions
- **In our test**: This found all 145 vulnerabilities

### Enrichment Source (Where CVSS Scores Come From)

**NVD CVE Cache** (PostgreSQL table: `nvd_cve_cache`)
- 5,467 CVEs cached locally
- CVSS v3.1, v3.0, and v2.0 scores
- Severity ratings (Critical/High/Medium/Low)
- Detailed technical descriptions
- **In our test**: This provided CVSS scores for 100% of vulnerabilities

## What You See in the Enhanced Report

Based on the actual template and our test results:

### Executive Summary
- **Total Vulnerabilities**: 145 (from our test)
- **Packages Affected**: 2 (curl and openssl)
- **Critical/High Issues**: Numbers that need immediate attention
- **Data Sources**: Shows "Debian OVAL" as the primary source

### Interactive Charts
- **CVSS Distribution**: Pie chart showing severity breakdown
- **Top Risk Packages**: Bar chart showing curl and openssl risk scores

### Package Summary
Shows packages with vulnerability counts:
```
curl: X vulnerabilities (breakdown by severity)
openssl: Y vulnerabilities (breakdown by severity)
```

### Detailed Vulnerability List
For each CVE (like CVE-2025-0725), you see:
- **CVE ID**: Clickable link to official CVE details
- **Severity Badge**: HIGH (color-coded orange)
- **CVSS Score**: 7.3
- **Package**: curl
- **Your Version**: 7.88.1-10+deb12u8
- **Fixed Version**: Available from Debian OVAL data
- **Description**: What the vulnerability actually does
- **Source**: "Debian OVAL"
- **Enhanced by NVD**: True (shows we added CVSS data)

### Filtering and Sorting
- **Search**: Find specific CVEs or packages
- **Severity Filter**: Show only Critical/High/Medium/Low
- **CVSS Range**: Filter by score range (e.g., only 7.0-10.0)
- **Sort Options**: By severity, CVSS score, date, or package name

## The Key Problem We Solved

### Before Our NVD Integration
- ❌ Debian OVAL data had CVE IDs but no CVSS scores
- ❌ No way to prioritize which vulnerabilities to fix first
- ❌ Reports showed "Unknown severity" for most CVEs

### After Our NVD Integration
- ✅ 100% of vulnerabilities have CVSS scores (in our test)
- ✅ Clear severity ratings (Critical/High/Medium/Low)
- ✅ Actionable prioritization based on risk scores
- ✅ Comprehensive vulnerability intelligence

## Automated Maintenance

### Weekly NVD Updates (Every Sunday 2 AM)
1. Connect to NVD API
2. Fetch new CVEs from the past week
3. Download CVSS scores and descriptions
4. Update local cache (currently 5,467 CVEs)
5. Log results for monitoring

### Monthly Maintenance (1st of month 3 AM)
1. Clean up old, irrelevant CVEs
2. Update access statistics
3. Verify data source health
4. Archive old scan results

### Rate Limiting Protection
- **Global coordinator**: Prevents API abuse
- **Exponential backoff**: Handles rate limit errors gracefully
- **Cache-first strategy**: Uses database before making API calls
- **30-second timeout**: Prevents user-facing delays

## Technical Architecture

```
Vuls Scanner → Package Inventory → Our Application → Enhanced Report
     ↓              ↓                    ↓              ↓
Server scan → JSON file with → Vulnerability → Web dashboard with
              package list     analysis        CVSS scores & risk
                              ↓
                         PostgreSQL Database
                         ├── Debian OVAL data (primary source)
                         ├── Ubuntu OVAL data (for Ubuntu systems)
                         └── NVD CVE cache (5,467 CVEs for enrichment)
```

## Real Performance Numbers

Based on our actual test with curl and openssl:

- **Input**: 2 security-critical packages
- **Processing time**: ~2 minutes (includes database queries and enrichment)
- **Output**: 145 vulnerabilities found
- **Enrichment success**: 100% (all CVEs got CVSS scores)
- **Data source**: Debian OVAL (primary) + NVD cache (enrichment)

## What This Means for You

1. **Complete Coverage**: We find vulnerabilities from official Debian security advisories.

2. **Actionable Intelligence**: Every vulnerability has a CVSS score so you can prioritize fixes.

3. **Reliable Data**: We use official sources (Debian OVAL) enhanced with authoritative CVSS data (NVD).

4. **Fast Results**: Local database queries mean quick scan results.

5. **Automated Updates**: System stays current without manual intervention.

The result is a robust vulnerability management system that transforms raw package data into actionable security intelligence, helping you keep your systems secure with clear priorities and comprehensive risk information.
