<!DOCTYPE html>
<html lang="en"{% if theme == 'dark' %} class="dark"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/css/custom.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23dc2626'><path d='M12 9a3.02 3.02 0 0 0-3 3c0 1.642 1.358 3 3 3 1.641 0 3-1.358 3-3 0-1.642-1.359-3-3-3z'/><path d='M12 5c-7.633 0-9.927 6.617-9.948 6.684L1.946 12l.105.316C2.073 12.383 4.367 19 12 19s9.927-6.617 9.948-6.684L22.054 12l-.105-.316C21.927 11.617 19.633 5 12 5zm0 12c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z'/></svg>">

    <style>
        /* Additional TailwindCSS configuration */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        /* Chart.js responsive fix */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-red-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 9a3.02 3.02 0 0 0-3 3c0 1.642 1.358 3 3 3 1.641 0 3-1.358 3-3 0-1.642-1.359-3-3-3z"/>
                            <path d="M12 5c-7.633 0-9.927 6.617-9.948 6.684L1.946 12l.105.316C2.073 12.383 4.367 19 12 19s9.927-6.617 9.948-6.684L22.054 12l-.105-.316C21.927 11.617 19.633 5 12 5zm0 12c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z"/>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white gradient-text">{{ title }}</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Generated on {{ generated_at }}</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>

                    <!-- Export Buttons -->
                    <div class="flex space-x-2">
                        <button id="export-pdf" class="export-btn inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600">
                            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                            </svg>
                            Print PDF
                        </button>
                        <button id="export-csv" class="export-btn inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600">
                            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Export CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Executive Summary -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Executive Summary</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Total Vulnerabilities -->
                <div class="stat-card bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Total Vulnerabilities</dt>
                                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{ scan_summary.total_vulnerabilities }}</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Packages Affected -->
                <div class="stat-card bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Packages Affected</dt>
                                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{ scan_summary.packages_affected }}</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Critical Issues -->
                <div class="stat-card bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-red-700" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">Critical Issues</dt>
                                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{ scan_summary.critical_count }}</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- High Priority -->
                <div class="stat-card bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg">
                    <div class="p-5">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-orange-700" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                                </svg>
                            </div>
                            <div class="ml-5 w-0 flex-1">
                                <dl>
                                    <dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate">High Priority</dt>
                                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{ scan_summary.high_count }}</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="mb-8 no-print">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Vulnerability Analytics</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- CVSS Distribution Chart -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                    <div class="chart-container">
                        <canvas id="cvss-chart"></canvas>
                    </div>
                </div>

                <!-- Package Risk Chart -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow">
                    <div class="chart-container">
                        <canvas id="package-risk-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Filters Sidebar -->
            <div class="lg:col-span-1 no-print">
                <div class="filter-sidebar bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Filters</h3>

                    <!-- Search -->
                    <div class="mb-6">
                        <label for="search-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search</label>
                        <input type="text" id="search-input" placeholder="CVE ID, package name..."
                               class="search-input w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>

                    <!-- Severity Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Severity</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="CRITICAL" class="severity-filter rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Critical</span>
                                <span class="ml-auto inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">{{ scan_summary.critical_count }}</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="HIGH" class="severity-filter rounded border-gray-300 text-orange-600 focus:ring-orange-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">High</span>
                                <span class="ml-auto inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">{{ scan_summary.high_count }}</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="MEDIUM" class="severity-filter rounded border-gray-300 text-yellow-600 focus:ring-yellow-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Medium</span>
                                <span class="ml-auto inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">{{ scan_summary.medium_count }}</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="LOW" class="severity-filter rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Low</span>
                                <span class="ml-auto inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">{{ scan_summary.low_count }}</span>
                            </label>
                        </div>
                    </div>

                    <!-- CVSS Score Range -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">CVSS Score Range</label>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-500">Min: <span id="cvss-min-label">0</span></span>
                                <span class="text-sm text-gray-500">Max: <span id="cvss-max-label">10</span></span>
                            </div>
                            <input type="range" id="cvss-min" min="0" max="10" step="0.1" value="0" class="range-slider w-full">
                            <input type="range" id="cvss-max" min="0" max="10" step="0.1" value="10" class="range-slider w-full">
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sort By</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button data-sort="severity" class="sort-btn btn-secondary px-3 py-2 text-xs rounded-md text-white">Severity</button>
                            <button data-sort="cvss" class="sort-btn btn-secondary px-3 py-2 text-xs rounded-md text-white">CVSS Score</button>
                            <button data-sort="date" class="sort-btn btn-secondary px-3 py-2 text-xs rounded-md text-white">Date</button>
                            <button data-sort="package" class="sort-btn btn-secondary px-3 py-2 text-xs rounded-md text-white">Package</button>
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <button id="clear-filters" class="btn-primary w-full px-4 py-2 text-sm font-medium text-white rounded-md">
                        Clear All Filters
                    </button>

                    <!-- Filter Stats -->
                    <div class="mt-4 text-sm text-gray-500 dark:text-gray-400 text-center">
                        <span id="filter-stats">Showing {{ data.total_vulnerabilities }} of {{ data.total_vulnerabilities }} vulnerabilities</span>
                    </div>
                </div>
            </div>

            <!-- Vulnerabilities List -->
            <div class="lg:col-span-3">
                <!-- Package Summary Section -->
                <div class="mb-8">
                    <div class="mb-4 flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Package Summary</h2>
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            Highest vulnerability per package
                        </div>
                    </div>

                    <div id="package-summary-container" class="space-y-3">
                        <!-- Package summaries will be rendered here by JavaScript -->
                    </div>
                </div>

                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">All Vulnerability Details</h2>
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        Total: {{ data.total_vulnerabilities }} vulnerabilities
                    </div>
                </div>

                <!-- Vulnerabilities Container -->
                <div id="vulnerabilities-container" class="space-y-4">
                    <!-- Vulnerabilities will be rendered here by JavaScript -->
                </div>

            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-12 no-print">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    Generated by Vulnerability Report Generator on {{ generated_at }}
                </div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    <a href="https://github.com" class="hover:text-gray-700 dark:hover:text-gray-300">View Source</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Data -->
    <script id="chart-data" type="application/json">{{ chart_data | tojson }}</script>
    <script id="vulnerability-data" type="application/json">{{ data.vulnerabilities | tojson }}</script>

    <script type="text/javascript">
        // Pass data to JavaScript
        window.chartData = JSON.parse(document.getElementById('chart-data').textContent);
        window.vulnerabilityData = JSON.parse(document.getElementById('vulnerability-data').textContent);

        // Set initial theme
        if (localStorage.getItem('theme') === 'dark' ||
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>

    <!-- Load JavaScript -->
    <script src="../static/js/report.js"></script>
</body>
</html>
